tinymce.PluginManager.add("image_gallery",function(e,t){
	function n(){
		var e;
		
		return e = '<table role="presentation" class="mce-grid">',
		jQuery.each(r, function(n, item){
			e += '<tr><td><a href="#" style="padding: 2px 5px; test-transform: " data-mce-url="'+item.id+'" tabindex="-1">'+item.name+'</a></td></tr>'; 
		}),
		e += "</table>"
	}
	var r;
	jQuery.getJSON('pages/gallery/gallery_dialog',function(json){
		r = json;
    });

	e.addButton("image_gallery",{
		type:"panelbutton",
		icon:"preview",
		popoverAlign:"bc-tl",
		panel:{
			autohide:!0,html:n,onclick:function(t){
				var n=e.dom.getParent(t.target,"a");
				n&&(e.insertContent('<p>[gallery='+n.getAttribute("data-mce-url")+']</p>'),this.hide())
			}
		},
		tooltip:"Image Gallery"
	})
});